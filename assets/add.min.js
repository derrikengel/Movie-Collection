firebase.initializeApp({apiKey:"AIzaSyDzKCN-wjRWLk7ojLlvqgWxi6jfC9e99Wc",authDomain:"movies-4348d.firebaseapp.com",projectId:"movies-4348d"});var db=firebase.firestore(),addMovie=new Vue({el:"#add-movie",data:()=>({user:{email:null,password:null,authenticated:!1,errorMsg:!1},movie:{id:null,title:"",year:"",imageUrl:"",vuduUrl:"",genre:[],genreValid:!1,rating:"",vuduQuality:"",gpQuality:"",maQuality:"",discFormat:"",length:"",description:"",notes:""},result:"",resultMessage:""}),mounted(){var vm=this;firebase.auth().onAuthStateChanged(user=>{vm.user.authenticated=!!user}),vm.movie.id&&db.collection("movies").doc(vm.movie.id).get().then((function(doc){if(doc.exists){var movie=doc.data();vm.movie.title=movie.title,vm.movie.year=movie.year,vm.movie.imageUrl=movie.image,vm.movie.vuduQuality=movie.vudu,vm.movie.gpQuality=movie.googlePlay,vm.movie.maQuality=movie.moviesAnywhere,vm.movie.discFormat=movie.disc,vm.movie.genre=movie.genre,vm.movie.rating=movie.rating,vm.movie.length=movie.length,vm.movie.description=movie.description,vm.movie.notes=movie.notes}else console.log("Document does not exist.")})).catch((function(error){console.log("Error getting document: ",error)}))},methods:{signIn(){var vm=this;firebase.auth().signInWithEmailAndPassword(vm.user.email,vm.user.password).catch(error=>{vm.user.errorMsg=!0})},updateImage(){var vm=this;if(vm.movie.vuduUrl&&!vm.movie.imageUrl){var movieId=vm.movie.vuduUrl.substring(vm.movie.vuduUrl.lastIndexOf("/")+1);vm.movie.imageUrl="https://images2.vudu.com/poster2/"+movieId+"-360"}},submitForm(){var vm=this;vm.movie.genre<1?this.$refs.genreLabel.scrollIntoView({behavior:"smooth"}):vm.movie.id?vm.updateMovie():vm.addMovie()},addMovie(){var vm=this;db.collection("movies").add({title:vm.movie.title,year:vm.movie.year,image:vm.movie.imageUrl,vudu:vm.movie.vuduQuality,googlePlay:vm.movie.gpQuality,moviesAnywhere:vm.movie.maQuality,disc:vm.movie.discFormat,genre:vm.movie.genre,rating:vm.movie.rating,length:vm.movie.length,description:vm.movie.description,dateAcquired:firebase.firestore.Timestamp.fromDate(new Date),notes:vm.movie.notes}).then(()=>{vm.result="success",vm.resultMessage=vm.movie.title+" successfully added!",vm.resetForm()}).catch(error=>{vm.result="error",vm.resultMessage="Error: "+error}),db.collection("lastUpdated").doc("lastUpdated").set({date:firebase.firestore.Timestamp.fromDate(new Date)}).then(()=>{}).catch(error=>{}),window.scrollTo(0,0),vm.sendNotification()},updateMovie(){var vm=this;db.collection("movies").doc(vm.movie.id).update({title:vm.movie.title,year:vm.movie.year,image:vm.movie.imageUrl,vudu:vm.movie.vuduQuality,googlePlay:vm.movie.gpQuality,moviesAnywhere:vm.movie.maQuality,disc:vm.movie.discFormat,genre:vm.movie.genre,rating:vm.movie.rating,length:vm.movie.length,description:vm.movie.description,notes:vm.movie.notes}).then(()=>{vm.result="success",vm.resultMessage=vm.movie.title+" successfully updated!"}).catch(error=>{vm.result="error",vm.resultMessage="Error: "+error}),window.scrollTo(0,0)},resetForm(){var vm=this;vm.movie.title="",vm.movie.year="",vm.movie.imageUrl="",vm.movie.vuduUrl="",vm.movie.genre=[],vm.movie.rating="",vm.movie.vuduQuality="",vm.movie.gpQuality="",vm.movie.maQuality="",vm.movie.discFormat="",vm.movie.length="",vm.movie.description="",vm.movie.notes=""},sendNotification(){var vm,message={app_id:"5eb5a37e-b458-11e3-ac11-000c2940e62c",contents:{en:this.movie.title},included_segments:["All"]};fetch("https://onesignal.com/api/v1/notifications",{method:"post",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:"Basic YzhmM2M4MzctMGI3Yi00MWI2LTgxODYtZWMyYTQ3NTdkMjAx"},body:JSON.stringify(message)}).then(result=>{}).catch(error=>{})}},created(){var vm=this,uri=window.location.search.substring(1),params=new URLSearchParams(uri);params.has("id")&&(vm.movie.id=params.get("id"))}});
Vue.use(VueLazyload);var router=new VueRouter({routes:[{path:"/screen-pass",name:"screen-pass"}]}),movies=new Vue({router:router,el:"#movies",data:()=>({movieData:null,loading:!0,errored:!1,activeItem:null,panelActive:!1,activeFilter:null,digitalFormats:[],physicalFormats:[],allGenres:[],allRatings:[],sort:"recent",search:"",formatFilter:[],ratingFilter:[],genreFilter:[],startYear:null,endYear:null,minYear:0,maxYear:0,randomMovie:!1,screenPass:!1,screenPassData:null,screenPassUser:null,screenPassAvailable:!0,screenPassStatus:null,screenPassCounter:null,currentMonth:null,requestFormActive:!1,requestName:null,requestTitle:null,requestStatus:null}),computed:{movies(){var self=this,movies=self.movieData,filteredMovies=_.filter(movies,movie=>{var search=!self.search||new RegExp("\\b"+self.search,"gi").test(movie.gsx$movietitle.$t),format=!self.formatFilter.length||(self.formatFilter.includes(movie.gsx$vudu.$t)||self.formatFilter.includes(movie.gsx$googleplay.$t)||self.formatFilter.includes(movie.gsx$disc.$t)),rating=!self.ratingFilter.length||self.ratingFilter.includes(movie.gsx$rating.$t),genre=!self.genreFilter.length||self.genreFilter.every(item=>movie.gsx$genre.$t.includes(item)),year=(self.startYear?movie.gsx$year.$t>=self.startYear:self.minYear)&&(self.endYear?movie.gsx$year.$t<=self.endYear:self.maxYear);return search&&format&&rating&&genre&&year});this.activeItem=null;var randomNum=_.random(filteredMovies.length-1);return self.randomMovie&&randomNum>-1?[filteredMovies[randomNum]]:"alpha"==self.sort?_.orderBy(filteredMovies):_.orderBy(filteredMovies,m=>m.gsx$acquired.$t?new Date(m.gsx$acquired.$t):"",["desc"])}},mounted(){axios.get("https://spreadsheets.google.com/feeds/list/1QrEHAN4o6dQe4PqCXg5_AkQ8u_j1nqt1GCpz90Lv5g4/1/public/values?alt=json").then(response=>{this.movieData=response.data.feed.entry,"screen-pass"==this.$route.name&&(this.movieData=this.movieData.filter(movie=>"Yes"==movie.gsx$screenpass.$t)),readCookie("movieRequester")&&(this.requestName=readCookie("movieRequester")),this.allGenres=[...new Set(this.movieData.flatMap(movie=>movie.gsx$genre.$t.split(", ")))].sort(),this.minYear=_.min(this.movieData.flatMap(movie=>movie.gsx$year.$t)),this.maxYear=_.max(this.movieData.flatMap(movie=>movie.gsx$year.$t));var vuduFormats,gpFormats,mergedFormats=[...this.movieData.flatMap(movie=>movie.gsx$vudu.$t),...this.movieData.flatMap(movie=>movie.gsx$googleplay.$t)];this.digitalFormats=[...new Set(mergedFormats)].filter(el=>""!=el).sort();var discFormats=this.movieData.flatMap(movie=>movie.gsx$disc.$t);this.physicalFormats=[...new Set(discFormats)].filter(el=>""!=el).sort();for(var ratings=[...new Set(this.movieData.flatMap(movie=>movie.gsx$rating.$t))],ratingsOrder=["G","TV-G","PG","TV-PG","PG-13","R","TV-MA","NR"],orderedratings=[],i=0;i<ratingsOrder.length;i++)ratings.indexOf(ratingsOrder[i])>-1&&orderedratings.push(ratingsOrder[i]);this.allRatings=orderedratings}).catch(error=>{console.log(error),this.errored=!0}).finally(()=>this.loading=!1),"screen-pass"==this.$route.name&&(this.screenPass=!0,this.sort="alpha",axios.get("https://spreadsheets.google.com/feeds/list/1QrEHAN4o6dQe4PqCXg5_AkQ8u_j1nqt1GCpz90Lv5g4/4/public/values?alt=json").then(response=>{this.screenPassData=response.data.feed.entry,readCookie("screenPassRequested")&&(this.screenPassAvailable=!1);var currentDate=new Date;currentDate.setHours(0,0,0,0);var currentMonth=currentDate.getMonth(),firstDay=new Date(currentDate.getFullYear(),currentMonth,1),lastDay=new Date(currentDate.getFullYear(),currentMonth+1,0),months=["January","February","March","April","May","June","July","August","September","October","November","December"];this.currentMonth=months[currentMonth];var currentRequests=this.screenPassData.filter(request=>{var requestDate=new Date(request.gsx$timestamp.$t).setHours(0,0,0,0);return requestDate>=firstDay&&requestDate<=lastDay});this.screenPassCounter=currentRequests.length<=3?currentRequests.length-3:0,this.screenPassCounter<1&&(this.screenPassAvailable=!1)}))},methods:{selectItem(index){index===this.activeItem?this.activeItem=null:this.activeItem=index,this.activeFilter=null,this.panelActive=!1},toggleFilters(){this.panelActive=!this.panelActive,this.panelActive&&(this.activeItem=null)},selectFilter(filter){filter===this.activeFilter?this.activeFilter=null:this.activeFilter=filter,this.activeItem=null},validateMinYear(){this.startYear&&this.startYear<this.minYear&&(this.startYear=this.minYear),this.startYear&&this.startYear>this.maxYear&&(this.startYear=this.maxYear)},validateMaxYear(){this.endYear&&this.endYear<this.minYear&&(this.endYear=this.minYear),this.endYear&&this.endYear>this.maxYear&&(this.endYear=this.maxYear)},selectRandom(){this.randomMovie=!1,this.randomMovie=!0,this.panelActive=!1,this.activeFilter=null},submitScreenPass(movie,year){},toggleRequestForm(e){this.requestFormActive=!this.requestFormActive,e.target.blur(),this.requestFormActive&&this.requestName?this.$refs.requestTitle.focus():this.requestFormActive&&this.$refs.requestName.focus()},submitRequest(){const scriptURL="https://script.google.com/macros/s/AKfycbzDLlzElZKNrEPIcrnQNV9P6duLdkufuq_g8QQSSTgi0yHvU3Y/exec",formData=new FormData;formData.append("Movie Title",this.requestTitle),formData.append("Requester",this.requestName),this.requestStatus="processing";var date=new Date;date.setFullYear(date.getFullYear()+1),setCookie("movieRequester",this.requestName,date),fetch(scriptURL,{method:"POST",body:formData}).then(result=>{this.requestStatus="success",this.requestTitle=null}).catch(error=>{console.error(error.message),this.requestStatus="error"})},reset(){this.activeItem=null,this.activeFilter=null,this.search="",this.formatFilter=[],this.ratingFilter=[],this.genreFilter=[],this.startYear=null,this.endYear=null,this.randomMovie=!1}}});setCookie=function(name,value,date){var expires="; expires="+date.toString();document.cookie=name+"="+value+expires+"; path=/"},readCookie=function(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null},clearCookie=function(name){setCookie(name,"",-1)};
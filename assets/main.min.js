firebase.initializeApp({apiKey:"AIzaSyDzKCN-wjRWLk7ojLlvqgWxi6jfC9e99Wc",authDomain:"movies-4348d.firebaseapp.com",projectId:"movies-4348d"});var db=firebase.firestore(),moviesRef=db.collection("movies"),movies=new Vue({el:"#movies",data:()=>({user:{id:null,email:null,password:null,name:null,authenticated:!1,errorMsg:!1},movieData:null,loading:!0,errored:!1,busy:!1,totalShown:0,scrollIncrement:30,movieCount:0,activeCard:null,panelActive:!1,activeFilter:null,digitalFormats:[],physicalFormats:[],allGenres:[],allRatings:[],sort:"recent",search:"",formatFilter:[],ratingFilter:[],genreFilter:[],startYear:null,endYear:null,minYear:0,maxYear:0,randomMovie:!1,request:{formActive:!1,title:null,status:null}}),computed:{movies(){var self=this,movies=self.movieData,filteredMovies=_.filter(movies,movie=>{var search=!self.search||new RegExp("\\b"+self.search,"gi").test(movie.title),format=!self.formatFilter.length||(self.formatFilter.includes(movie.vudu)||self.formatFilter.includes(movie.googlePlay)||self.formatFilter.includes(movie.disc)),rating=!self.ratingFilter.length||self.ratingFilter.includes(movie.rating),genre=!self.genreFilter.length||self.genreFilter.every(item=>movie.genre.includes(item)),year=(self.startYear?movie.year>=self.startYear:self.minYear)&&(self.endYear?movie.year<=self.endYear:self.maxYear);return search&&format&&rating&&genre&&year});self.movieCount=filteredMovies.length,self.activeCard=null;var randomNum=_.random(filteredMovies.length-1);return self.randomMovie&&randomNum>-1?(self.movieCount=1,[filteredMovies[randomNum]]):"alpha"==self.sort?_.take(_.orderBy(filteredMovies,["title"],["asc"]),self.totalShown):_.take(_.orderBy(filteredMovies,m=>m.dateAcquired.toDate(),["desc"]),self.totalShown)}},mounted(){var vm=this;moviesRef.get().then(querySnapshot=>{this.movieData=querySnapshot.docs.map(doc=>doc.data()),this.allGenres=[...new Set(this.movieData.flatMap(movie=>movie.genre))].sort(),this.minYear=_.min(this.movieData.flatMap(movie=>movie.year)),this.maxYear=_.max(this.movieData.flatMap(movie=>movie.year));var vuduFormats,gpFormats,mergedFormats=[...this.movieData.flatMap(movie=>movie.vudu),...this.movieData.flatMap(movie=>movie.googlePlay)];this.digitalFormats=[...new Set(mergedFormats)].filter(el=>""!=el).sort();var discFormats=this.movieData.flatMap(movie=>movie.disc);this.physicalFormats=[...new Set(discFormats)].filter(el=>""!=el).sort();for(var ratings=[...new Set(this.movieData.flatMap(movie=>movie.rating))],ratingsOrder=["G","TV-G","PG","TV-PG","PG-13","TV-14","R","TV-MA","NR"],orderedratings=[],i=0;i<ratingsOrder.length;i++)ratings.indexOf(ratingsOrder[i])>-1&&orderedratings.push(ratingsOrder[i]);this.allRatings=orderedratings}).catch(error=>{console.log(error),this.errored=!0}).finally(()=>this.loading=!1),firebase.auth().onAuthStateChanged(user=>{user?(vm.user.authenticated=!0,vm.user.id=user.uid,vm.user.name=user.displayName,vm.user.errorMsg=null):(vm.user.authenticated=!1,vm.user.id=null,vm.user.name=null)})},methods:{loadMore(){this.busy=!0,this.totalShown+=this.scrollIncrement,this.busy=!1},selectItem(index){index===this.activeCard?this.activeCard=null:this.activeCard=index,this.activeFilter=null,this.panelActive=!1},toggleFilters(){this.panelActive=!this.panelActive,this.panelActive&&(this.activeCard=null)},selectFilter(filter){filter===this.activeFilter?this.activeFilter=null:this.activeFilter=filter,this.activeCard=null},validateMinYear(){this.startYear&&this.startYear<this.minYear&&(this.startYear=this.minYear),this.startYear&&this.startYear>this.maxYear&&(this.startYear=this.maxYear)},validateMaxYear(){this.endYear&&this.endYear<this.minYear&&(this.endYear=this.minYear),this.endYear&&this.endYear>this.maxYear&&(this.endYear=this.maxYear)},selectRandom(){this.randomMovie=!1,this.randomMovie=!0,this.panelActive=!1,this.activeFilter=null},toggleRequestForm(e){this.request.formActive=!this.request.formActive,e.target.blur(),this.request.formActive&&this.$refs.requestTitle.focus()},signIn(){var vm=this;firebase.auth().signInWithEmailAndPassword(vm.user.email,vm.user.password).catch(error=>{vm.user.errorMsg=!0})},submitRequest(){var scriptURL="https://script.google.com/macros/s/AKfycbzDLlzElZKNrEPIcrnQNV9P6duLdkufuq_g8QQSSTgi0yHvU3Y/exec",formData=new FormData;formData.append("Movie Title",this.request.title),formData.append("Requester",this.user.name),this.request.status="processing",fetch(scriptURL,{method:"POST",body:formData}).then(result=>{this.request.status="success",this.request.title=null}).catch(error=>{console.error(error.message),this.request.status="error"})},reset(){this.activeCard=null,this.activeFilter=null,this.search="",this.formatFilter=[],this.ratingFilter=[],this.genreFilter=[],this.startYear=null,this.endYear=null,this.randomMovie=!1},documentClick(e){var target=e.target,filterPanel=this.$refs.filterPanel,filterPanelBtn=this.$refs.filterPanelBtn;filterPanel===target||filterPanel.contains(target)||filterPanelBtn===target||filterPanelBtn.contains(target)||(this.panelActive=!1);var filters=this.$refs.filterOption,filterClicked=!1;for(var filter of filters)if(filter==target||filter.contains(target)){filterClicked=!0;break}filterClicked||(this.activeFilter=null)}},created(){document.addEventListener("click",this.documentClick)},destroyed(){document.removeEventListener("click",this.documentClick)}});setCookie=function(name,value,date){var expires="; expires="+date.toString();document.cookie=name+"="+value+expires+"; path=/"},readCookie=function(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null},clearCookie=function(name){setCookie(name,"",-1)};